name: Terraform
on:
  push:
    branches:
      - '**'
    paths:
      - 'terraform/**'
    paths-ignore:
      - '.github/workflows/ci.yml'


permissions:
  contents: read

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: 'install tf'
      uses: hashicorp/setup-terraform@v1

    - name: Setup Terragrunt
      uses: autero1/action-terragrunt@v1.1.0
      with:
        terragrunt_version: latest
    - name: Check Terragrunt
      run: terragrunt --version
    - name: Terragrunt apply
      env:
        AWS_ACCESS_KEY_ID: {{secrets.AWS_ACCESS_KEY_ID}}
        AWS_SECRET_ACCESS_KEY: {{secrets.AWS_SECRET_ACCESS_KEY}}
      run: make tf-apply-app
